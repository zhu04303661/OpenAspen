# DWSIM5 项目架构图

## 1. 整体分层架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           DWSIM5 项目架构                                          │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              用户界面层 (UI Layer)                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │   经典UI    │  │  跨平台UI   │  │  控件库     │  │      绘图子系统         │  │
│  │ (WinForms)  │  │ (Eto.Forms) │  │ Controls    │  │   (SkiaSharp-based)     │  │
│  │             │  │             │  │             │  │                       │  │
│  │             │  │             │  │             │  │                       │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
│                                                                                   │
│  ┌───────────────────────────────────────────────────────────────────────────┐  │
│  │        平台特定实现 (Platform-Specific Implementations)                     │  │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐  │  │
│  │  │  WinForms   │ │    WPF      │ │    GTK      │ │       Mac           │  │  │
│  │  │  Handler    │ │   Handler   │ │   Handler   │ │      Handler        │  │  │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                          业务逻辑层 (Business Logic Layer)                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────────────┐  │
│  │  流程图求解器   │  │   单元操作库    │  │        插件系统                 │  │
│  │ FlowsheetSolver │  │ UnitOperations  │  │      Plugin System              │  │
│  │                 │  │                 │  │  ┌─────────────────────────────┐ │  │
│  │ • 计算调度      │  │ • 反应器        │  │  │ • Natural Gas Plugin        │ │  │
│  │ • 依赖解析      │  │ • 分离器        │  │  │ • 第三方插件接口            │ │  │
│  │ • 收敛检查      │  │ • 换热器        │  │  │ • CAPE-OPEN 标准            │ │  │
│  │ • 异步计算      │  │ • 泵/压缩机     │  │  │ • 分布式计算                    │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           计算引擎层 (Computation Engine)                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                        热力学引擎 (Thermodynamics)                           │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐  │ │
│  │  │  物性包     │ │  闪蒸算法   │ │  状态方程   │ │    活度系数模型     │  │ │
│  │  │PropertyPkg  │ │FlashAlgos   │ │    EOS      │ │ Activity Coeff      │  │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                         数学运算库 (Math Libraries)                          │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐  │ │
│  │  │  核心数学   │ │  优化算法   │ │  数值积分   │ │    随机数生成       │  │ │
│  │  │  MathOps    │ │  SwarmOps   │ │  Simpson    │ │    RandomOps        │  │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                        数据访问层 (Data Access Layer)                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                      数据库连接器 (Database Connectors)                      │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐  │ │
│  │  │ KDB数据库   │ │Chemeo数据库 │ │ DDB结构库   │ │   ChEDL热力学库     │  │ │
│  │  │   Linker    │ │   Linker    │ │   Linker    │ │      Linker         │  │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │  ┌─────────────────┐              ┌─────────────────────────────────────┐   │ │
│  │  │  XML序列化器    │              │        文件系统接口                 │   │ │
│  │  │ XMLSerializer   │              │      File System Access            │   │ │
│  │  └─────────────────┘              └─────────────────────────────────────┘   │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           核心架构层 (Core Architecture)                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                        接口定义层 (Interface Layer)                          │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐  │ │
│  │  │IFlowsheet   │ │ISimulation  │ │IProperty    │ │   IGraphicObject    │  │ │
│  │  │IFlashAlgo   │ │Object       │ │Package      │ │   IMaterialStream   │  │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                      共享类库 (Shared Libraries)                             │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐  │ │
│  │  │ 基础类定义  │ │ 扩展方法库  │ │ 全局设置    │ │    单位换算系统     │  │ │
│  │  │SharedClasses│ │Extension    │ │GlobalSetting│ │   UnitsOfMeasure    │  │ │
│  │  │             │ │Methods      │ │             │ │                     │  │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                      集成与自动化层 (Integration & Automation)                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────────────┐  │
│  │  自动化API      │  │   外部集成      │  │        服务器应用               │  │
│  │   Automation    │  │External Integr. │  │      Server Applications        │  │
│  │                 │  │                 │  │                                 │  │
│  │ • COM接口       │  │ • Python Link   │  │ • TCP Server                    │  │
│  │ • 脚本自动化    │  │ • Octave Link   │  │ • Azure Server                  │  │
│  │ • 批处理        │  │ • CoolProp IF   │  │ • 分布式计算                    │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 2. 核心组件交互图

```
                        DWSIM5 核心组件交互关系图

    ┌─────────────┐    events    ┌─────────────────┐    calls    ┌─────────────┐
    │    UI层     │ ────────────▶│  FlowsheetSolver │ ──────────▶│ UnitOps库   │
    │(Forms/Views)│              │                 │            │             │
    └─────────────┘              └─────────────────┘            └─────────────┘
           │                              │                            │
           │ binds                        │ uses                       │ uses
           ▼                              ▼                            ▼
    ┌─────────────┐              ┌─────────────────┐            ┌─────────────┐
    │ GraphicObj  │              │ MaterialStream  │            │ Thermo Pkg  │
    │   (UI元素)  │              │   (物流)        │            │  (物性包)   │
    └─────────────┘              └─────────────────┘            └─────────────┘
           │                              │                            │
           │ represents                   │ calculates                 │ uses
           ▼                              ▼                            ▼
    ┌─────────────┐              ┌─────────────────┐            ┌─────────────┐
    │SimulationObj│              │  PhaseProperties│            │FlashAlgorithm│
    │  (仿真对象) │              │   (相平衡)      │            │  (闪蒸算法) │
    └─────────────┘              └─────────────────┘            └─────────────┘
                                          │                            │
                                          │ computed by                │ uses
                                          ▼                            ▼
                                 ┌─────────────────┐            ┌─────────────┐
                                 │   Math Engine   │            │  Database   │
                                 │   (数学引擎)    │            │  (数据库)   │
                                 └─────────────────┘            └─────────────┘
```

## 3. 数据流架构图

```
                           DWSIM5 数据流架构图

输入数据源
    │
    ├─ 化合物数据库 ──┐
    ├─ 操作参数     ──┤
    ├─ 流程图配置   ──┤
    └─ 用户设置     ──┘
                      │
                      ▼
                ┌─────────────┐
                │  数据验证   │
                │   模块      │
                └─────────────┘
                      │
                      ▼
                ┌─────────────┐     ┌─────────────────┐
                │  物性计算   │────▶│   热力学模型    │
                │   引擎      │     │   (EOS/γ模型)   │
                └─────────────┘     └─────────────────┘
                      │                      │
                      ▼                      │
                ┌─────────────┐              │
                │ 单元操作    │◀─────────────┘
                │  计算模块   │
                └─────────────┘
                      │
                      ▼
                ┌─────────────┐     ┌─────────────────┐
                │ 流程图求解  │────▶│   收敛性检查    │
                │   调度器    │     │                 │
                └─────────────┘     └─────────────────┘
                      │                      │
                      ▼                      │
                ┌─────────────┐              │
                │  结果输出   │◀─────────────┘
                │   模块      │
                └─────────────┘
                      │
                      ▼
    输出结果
    │
    ├─ 流股属性表
    ├─ 设备性能参数  
    ├─ 图表报告
    └─ 导出文件
```

## 4. 跨平台UI架构图

```
                     DWSIM5 跨平台UI架构图

┌─────────────────────────────────────────────────────────────────────────────┐
│                          共享业务逻辑层                                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 流程图模型  │  │  编辑器逻辑 │  │  数据绑定   │  │      事件处理       │  │
│  │FlowsheetBase│  │ Editors     │  │  Logic      │  │   Event Handlers    │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ Eto.Forms Abstraction
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Eto.Forms 抽象层                                     │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │               Platform-Agnostic Controls & Forms                       │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┬───────────────┐
                    ▼               ▼               ▼               ▼
        ┌─────────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
        │   Windows       │ │    Linux    │ │    macOS    │ │   移动平台  │
        │   Platform      │ │  Platform   │ │  Platform   │ │   (未来)    │
        ├─────────────────┤ ├─────────────┤ ├─────────────┤ ├─────────────┤
        │ ┌─────────────┐ │ │ ┌─────────┐ │ │ ┌─────────┐ │ │             │
        │ │  WinForms   │ │ │ │   GTK   │ │ │ │MonoMac  │ │ │             │
        │ │   Handler   │ │ │ │ Handler │ │ │ │Handler  │ │ │             │
        │ └─────────────┘ │ │ └─────────┘ │ │ └─────────┘ │ │             │
        │ ┌─────────────┐ │ │             │ │ ┌─────────┐ │ │             │
        │ │    WPF      │ │ │             │ │ │   GTK   │ │ │             │
        │ │   Handler   │ │ │             │ │ │ Handler │ │ │             │
        │ └─────────────┘ │ │             │ │ └─────────┘ │ │             │
        └─────────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
```

## 5. 插件系统架构图

```
                        DWSIM5 插件系统架构图

    ┌─────────────────────────────────────────────────────────────────────┐
    │                        DWSIM 核心系统                                │
    │  ┌─────────────────┐              ┌─────────────────────────────┐   │
    │  │   插件管理器    │              │       接口定义              │   │
    │  │ Plugin Manager  │              │    Interface Definitions    │   │
    │  │                 │              │                             │   │
    │  │ • 插件发现      │              │ • IExternalUnitOperation    │   │
    │  │ • 生命周期管理  │              │ • IUtilityPlugin            │   │
    │  │ • 依赖注入      │              │ • IPropertyPackage          │   │
    │  └─────────────────┘              └─────────────────────────────┘   │
    └─────────────────────────────────────────────────────────────────────┘
                          │                            ▲
                          │ 加载/管理                   │ 实现
                          ▼                            │
    ┌─────────────────────────────────────────────────────────────────────┐
    │                        插件实现层                                    │
    │                                                                     │
    │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────┐ │
    │  │   内置插件      │  │   第三方插件    │  │   CAPE-OPEN插件     │ │
    │  │                 │  │                 │  │                     │ │
    │  │ • NaturalGas    │  │ • 用户自定义    │  │ • 标准接口          │ │
    │  │   Plugin        │  │   插件          │  │ • COM组件           │ │
    │  │                 │  │ • 商业插件      │  │ • 互操作性          │ │
    │  └─────────────────┘  └─────────────────┘  └─────────────────────┘ │
    └─────────────────────────────────────────────────────────────────────┘
```

这些架构图展示了DWSIM5项目的：

1. **分层架构设计** - 清晰的职责分离
2. **组件交互关系** - 各模块间的依赖和通信
3. **数据流处理** - 从输入到输出的完整流程
4. **跨平台UI实现** - 基于Eto.Forms的抽象层设计
5. **插件系统扩展** - 支持第三方扩展的架构

这种架构设计确保了DWSIM5的可维护性、可扩展性和跨平台兼容性。 